import{a as O,j as e,I as T,H,J as E,r as d,N as J,h as f,B as k,d as K,i as Q,c as Y,b as W,S as A,E as L,e as Z,u as $,K as G,g as V,s as X,O as ee,P as se,Q as M,o as re,M as te}from"./index-oWofQvTe.js";import{P as ae}from"./Pagination-CBTeQeP8.js";import{M as U}from"./index-CN5pHmso.js";import{M as ne,S as ie}from"./SubTitle-BLLgEfMd.js";import{P as ce}from"./PathInfo-N6uEAlQG.js";const oe="_userWrap_1tqpz_1",le="_userImgWrap_1tqpz_17",pe="_userImg_1tqpz_17",ue="_userImgBtn_1tqpz_26",me="_userName_1tqpz_41",de="_userDetails_1tqpz_47",he="_userDetailInfo_1tqpz_52",fe="_userDetailsInfoNumber_1tqpz_60",ge="_userImgInput_1tqpz_101",_e="_userImgBtnIcon_1tqpz_104",o={userWrap:oe,userImgWrap:le,userImg:pe,userImgBtn:ue,userName:me,userDetails:de,userDetailInfo:he,userDetailsInfoNumber:fe,userImgInput:ge,userImgBtnIcon:_e},Ie=({id:i,name:a,email:x,avatar:p,totalFavoritesRecipes:g,totalFollowers:_,totalFollowings:s,totalRecipes:l,isOwner:r})=>{const t=O(),u=async n=>{const m=n.target.files[0];if(!m)return;const N=new FormData;N.append("avatar",m),await t(H(N)).unwrap().then(()=>t(E(i)))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:o.userWrap,children:[e.jsxs("div",{className:o.userImgWrap,children:[e.jsx("img",{className:o.userImg,src:p,alt:""}),r?e.jsxs("div",{children:[e.jsx("input",{id:"file-upload",type:"file",className:o.userImgInput,onChange:u}),e.jsx("label",{htmlFor:"file-upload",className:o.userImgBtn,children:e.jsx(T,{iconId:"plus",className:o.userImgBtnIcon,width:17,height:16})})]}):e.jsx(e.Fragment,{})]}),e.jsx("p",{className:o.userName,children:a}),e.jsxs("ul",{className:o.userDetails,children:[e.jsxs("li",{className:o.userDetailInfo,children:["Email:",e.jsx("span",{className:o.userDetailsInfoNumber,children:x})]}),e.jsxs("li",{className:o.userDetailInfo,children:["Added recipes:",e.jsx("span",{className:o.userDetailsInfoNumber,children:l})]}),r?e.jsxs("li",{className:o.userDetailInfo,children:["Favorites:",e.jsx("span",{className:o.userDetailsInfoNumber,children:g})]}):e.jsx(e.Fragment,{}),e.jsxs("li",{className:o.userDetailInfo,children:["Followers:",e.jsx("span",{className:o.userDetailsInfoNumber,children:_})]}),r?e.jsxs("li",{className:o.userDetailInfo,children:["Following:",e.jsx("span",{className:o.userDetailsInfoNumber,children:s})]}):e.jsx(e.Fragment,{})]})]})})},xe="_containerUser_1me76_1",ve="_logOutBtn_1me76_7",we="_loaderWrapper_1me76_14",je="_userInfoButtonWrapper_1me76_26",Ne="_userWrapper_1me76_33",y={containerUser:xe,logOutBtn:ve,loaderWrapper:we,userInfoButtonWrapper:je,userWrapper:Ne},be="_tabsContainer_1u0gh_1",Pe="_tabsContainerButton_1u0gh_4",Be="_tabsList_1u0gh_17",De="_tabItem_1u0gh_21",ye="_tabItemActive_1u0gh_33",Ce="_listReceipes_1u0gh_53",C={tabsContainer:be,tabsContainerButton:Pe,tabsList:Be,tabItem:De,tabItemActive:ye,listReceipes:Ce},We="_recipePreviewItem_1snpi_1",ke="_recipePreviewImg_1snpi_7",Le="_recipePreviewOverlay_1snpi_13",Fe="_recipePreviewIcon_1snpi_19",Se="_recipePreviewWrapperIcon_1snpi_22",$e="_recipePreviewTitle_1snpi_27",Ee="_recipePreviewDescription_1snpi_34",Re="_recipePreviewBtn_1snpi_40",j={recipePreviewItem:We,recipePreviewImg:ke,recipePreviewOverlay:Le,recipePreviewIcon:Fe,recipePreviewWrapperIcon:Se,recipePreviewTitle:$e,recipePreviewDescription:Ee,recipePreviewBtn:Re},ze=({title:i,description:a,thumb:x,id:p,isOwner:g,onDelete:_,activeTab:s})=>{const[l,r]=d.useState(50),[t,u]=d.useState(13);d.useEffect(()=>{const v=()=>{const b=window.innerWidth;b<768?(r(50),u(13)):b>=768&&b<1440?(r(160),u(40)):(r(160),u(70))};return v(),window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}},[]);const n=async()=>{try{s==="recipes"?(await f.delete(`/recipes/${p}`),_(p)):s==="favorites"&&(await f.delete(`/recipes/${p}/favorites`),_(p))}catch(v){toast.error(v.response.data.message)}},m=(a==null?void 0:a.length)>l?a.substring(0,l)+"...":a,N=(i==null?void 0:i.length)>t?i.substring(0,t)+"...":i;return e.jsxs("li",{className:j.recipePreviewItem,children:[e.jsx("img",{className:j.recipePreviewImg,src:x,alt:""}),e.jsxs("div",{className:j.recipePreviewOverlay,children:[e.jsx("p",{className:j.recipePreviewTitle,children:N}),e.jsx("p",{className:j.recipePreviewDescription,children:m})]}),e.jsxs("div",{className:j.recipePreviewWrapperIcon,children:[e.jsx(J,{className:j.recipePreviewBtn,to:`/recipe/${p}`,children:e.jsx(U,{})}),g?e.jsx("button",{onClick:n,className:j.recipePreviewBtn,children:e.jsx(T,{iconId:"trash",className:j.recipePreviewIcon,width:18,height:18,stroke:"#050505",children:" "})}):e.jsx(e.Fragment,{})]})]})},Me="_userCardItem_1fkkn_1",Oe="_userName_1fkkn_20",Te="_userDescription_1fkkn_35",Ae="_userInfo_1fkkn_49",Ue="_avatarWrapper_1fkkn_58",qe="_recipeImageList_1fkkn_72",He="_imageWrapper_1fkkn_81",Je="_imageItem_1fkkn_93",Ke="_mainBtn_1fkkn_97",Qe="_secondaryBtn_1fkkn_113",h={userCardItem:Me,userName:Oe,userDescription:Te,userInfo:Ae,avatarWrapper:Ue,recipeImageList:qe,imageWrapper:He,imageItem:Je,mainBtn:Ke,secondaryBtn:Qe},B=["follow","following"],Ye=({avatar:i,id:a,name:x,recipes:p,activeTab:g,ownsRecipes:_,onDelete:s=null,subscribe:l,handleClickNavigate:r})=>{const t=l?B[1]:B[0],u=async n=>{if(n.target.textContent===B[0]&&g==="followers"){await f.post("/users/subscribe",{subscribedTo:a}).then(m=>{n.target.textContent=B[1]});return}if(n.target.textContent===B[1]&&g==="followers"){await f.delete(`/users/unsubscribe/${a}`).then(m=>{n.target.textContent=B[0]});return}if(n.target.textContent===B[1]&&g==="following"){await f.delete(`/users/unsubscribe/${a}`).then(m=>{s(a)});return}};return e.jsxs("li",{className:h.userCardItem,children:[e.jsxs("div",{className:h.userInfo,children:[e.jsx("div",{className:h.avatarWrapper,children:e.jsx("img",{className:h.userAvatarImage,src:i||"",alt:"Avatar",onError:({currentTarget:n})=>{n.onerror=null,n.src="https://placehold.co/85x85/BFBEBE/050505?text=Avatar"},loading:"lazy"})}),e.jsxs("div",{className:h.userDetails,children:[e.jsxs("h3",{className:h.userName,children:[x,"r"]}),e.jsx("p",{className:h.userDescription,children:`Own recipes: ${_}`}),e.jsx(k,{onClick:u,className:h.mainBtn,children:t})]})]}),e.jsx("ul",{className:h.recipeImageList,children:p.map(n=>e.jsx("li",{className:h.imageItem,children:e.jsx("div",{className:h.imageWrapper,children:e.jsx("img",{className:h.recipeImage,src:n.thumb,alt:"Recipe img",onError:({currentTarget:m})=>{m.onerror=null,m.src="https://placehold.co/100x100/BFBEBE/050505?text=Recipe"},loading:"lazy"},n.id)})},n.id))}),e.jsx(k,{onClick:()=>r(a),className:h.secondaryBtn,children:e.jsx(U,{})})]})},Ze=({isOwner:i,id:a,totalRecipes:x,totalFollowers:p,totalFollowings:g,totalFavoritesRecipes:_})=>{const[s,l]=d.useState("recipes"),[r,t]=d.useState([]),[u,n]=d.useState(!0),[m]=K(),N=Q(),[v,b]=d.useState([]);let w=m.get("page")||1;d.useEffect(()=>{t([]);const c=async()=>{n(!0);try{let I;i?s==="following"||s==="favorites"?I=(await f.get(`/users/${s}/`)).data:I=(await f.get(`/users/${s}/${a}`,{params:{limit:9,page:w}})).data:I=(await f.get(`/users/${s}/${a}`)).data,t(I?I.data:[])}catch(I){L.error(I.response.data.message),t([])}finally{n(!1)}};(async I=>{try{const{data:P}=await f.get("/users/following");P&&b(P.data)}catch(P){L.error(P.response)}})(),c()},[s,w,a,i,p]),d.useEffect(()=>{l("recipes")},[a]);const R=c=>{l("recipes"),N(`/user/${c}`)},D=c=>{t([]),l(c)},z={recipes:i?"My Recipes":"Recipes",favorites:"My Favorite",followers:"Followers",following:"Following"},F=c=>{t(S=>S.filter(I=>I.id!==c))},q=i?["recipes","favorites","followers","following"]:["recipes","followers"];return e.jsxs("div",{className:C.tabsContainer,children:[e.jsx("div",{className:C.tabsContainerButton,children:e.jsx("div",{className:C.tabsList,children:q.map(c=>e.jsx("button",{className:`${C.tabItem} ${s===c?C.tabItemActive:""}`,onClick:()=>D(c),children:z[c]},c))})}),e.jsx("div",{className:Y("list-items",C.listReceipes),children:u?e.jsx(W,{size:A.medium}):(r==null?void 0:r.length)===0?e.jsx("p",{children:"Nothing has been added to your recipes list yet. Please browse our recipes and add your favorites for easy access in the future."}):e.jsx("ul",{children:r==null?void 0:r.map(c=>s==="recipes"||s==="favorites"?e.jsx(ze,{...c,isOwner:i,onDelete:F,activeTab:s},c.id):e.jsx(Ye,{...c,isOwner:i,onDelete:F,activeTab:s,subscribe:v.some(S=>S.id===c.id),handleClickNavigate:R},c.id))})}),e.jsx(ae,{total:s==="recipes"?x:s==="favorites"?_:s==="followers"?p:g,limit:9})]})},rs=()=>{const[i,a]=d.useState(!1),[x,p]=d.useState(!1),[g,_]=d.useState(!1),{id:s}=Z(),l=O(),r=$(G),t=$(V),u=$(X),n=$(ee);d.useEffect(()=>{a(u)},[u]);const m=w=>{l(re(w))},N=async()=>{try{a(!0),await f.post("/users/subscribe/",{subscribedTo:s}),p(!0)}catch(w){L.error(w.response.data.message)}finally{a(!1),l(E(s))}},v=async()=>{try{a(!0),await f.delete(`/users/unsubscribe/${s}`),p(!1)}catch(w){L.error(w.response.data.message)}finally{a(!1),l(E(s))}},b=()=>{m(te.logout)};return d.useEffect(()=>{s&&l(E(s)),t||l(se()),(async R=>{try{const{data:D}=await f.get("/users/following");D&&_(D.data);const z=g.some(F=>F.id===R);p(z)}catch(D){L.error(D.response)}})(s)},[l,s,t]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container",children:[e.jsx(ce,{currentPageName:"Profile"}),e.jsx(ne,{children:" Profile"}),e.jsx(ie,{children:"Reveal your culinary art, share your favorite recipe and create gastronomic masterpieces with us."}),e.jsxs("div",{className:y.userWrapper,children:[e.jsxs("div",{className:y.userInfoButtonWrapper,children:[n||u?e.jsx("div",{className:y.loaderWrapper,children:e.jsx(W,{size:A.large})}):e.jsx(Ie,{...r,isOwner:(t==null?void 0:t.id)===s}),(t==null?void 0:t.id)===s?e.jsx(k,{onClick:b,className:y.logOutBtn,children:"Log Out"}):x?e.jsx(k,{onClick:v,className:y.logOutBtn,children:i?e.jsx(W,{color:M.white}):"Following"}):e.jsx(k,{onClick:N,className:y.logOutBtn,children:i?e.jsx(W,{color:M.white}):"Follow"})]}),u?e.jsx(W,{}):e.jsx(Ze,{totalRecipes:r==null?void 0:r.totalRecipes,totalFollowers:r==null?void 0:r.totalFollowers,totalFollowings:r==null?void 0:r.totalFollowings,totalFavoritesRecipes:r==null?void 0:r.totalFavoritesRecipes,isOwner:(t==null?void 0:t.id)===s,id:s})]})]})})};export{rs as default};
